/*! NBkit | @version 1.3.0 | @author NB Communication Ltd <info@nbcommunication.com> | @copyright 2021 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("uikit")):"function"==typeof define&&define.amd?define("nbkit",["uikit"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).NBkit=e(t.UIkit)}(this,(function(t){"use strict";var e={duration:256,offset:0,ukAlert:{animation:!0,duration:256},ukNotification:{status:"primary",pos:"top-right",timeout:4096}};function i(e){if(Array.isArray(e))return e.join(" ");if(t.util.isPlainObject(e)){const i=[];let n;for(let r in e)if(t.util.hasOwn(e,r)){if(n=e[r],t.util.isPlainObject(n))break;t.util.isBoolean(n)&&(n=String(n)),r=t.util.hyphenate(r),i.push(`${r}: ${n}`)}return Object.keys(e).length===i.length?i.join("; "):JSON.stringify(e)}return String(e)}function n(t,e){try{return l(t=atob(t),"",!1,e)}catch(t){return""}}function r(e,i=""){return Array.isArray(e)&&(e=e.join(i)),t.util.isPlainObject(e)&&(e=JSON.stringify(e)),"string"==typeof e?btoa(e):""}function l(e,i,r=!1,l=""){if(t.util.isPlainObject(e))return e;let s;if(t.util.isNode(e)&&(s=e,e=i?t.util.data(s,i):""),r)return s&&["","data-"].forEach((e=>{let n=e+i;t.util.hasAttr(s,n)&&t.util.removeAttr(s,n)})),e?n(e,l):{};if(l&&t.util.includes(e,l))e=e.split(l);else try{const i=t.util.parseOptions(e);t.util.isEmpty(i)||(e=i)}catch(n){i&&t.util.includes(e,i)&&(e=e.split(i))}return e}const s="localStorage"in window&&"sessionStorage"in window;function o(t){return/<[a-z][\s\S]*>/i.test(t)}function u(t){return o(t)?t:("<"===t.substr(0,1)?"":"<")+t+(">"===t.substr(t.length-1,1)?"":">")}function a(t){return"profiler"in window?profiler.start(t):null}function c(t){return"profiler"in window?profiler.stop(t):0}function f(t,e="."){return/.*[.,\/!?\^&\*;:{}=]$/.test(t)||(t+=e),t}function d(e){return t.util.isPlainObject(e)&&!t.util.isEmpty(e)?"?"+Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&"):""}function h(i,n){t.util.isUndefined(i)||t.util.isUndefined(n)||i in e&&(t.util.isPlainObject(e[i])&&t.util.isPlainObject(n)?e[i]=t.util.assign({},e[i],n):e[i]=n)}function p(e="",i={}){if(a("NBkit.ajax"),t.util.isPlainObject(e)&&(i=e,e=""),e||(e=window.location.href),t.util.isPlainObject(i)||(i={}),t.util.includes(e,"#")){let t=e.split("#"),i=t[1].split("?");e=`${t[0]}${i.length>1?"?"+i[1]:""}#${i[0]}`}return(i=t.util.assign({headers:{},method:"GET",responseType:"text/html"},i)).headers["X-Requested-With"]="XMLHttpRequest",new t.util.Promise(((n,r)=>{t.util.ajax(e,i).then((t=>{c("NBkit.ajax"),n(t)}),(t=>{c("NBkit.ajax"),r(t)}))}))}function m(e,i=new FormData,n=""){if(e instanceof HTMLFormElement)return new FormData(e);let r=i;for(let i in e)t.util.hasOwn(e,i)&&(t.util.isPlainObject(e[i])?m(e[i],r,i):r.append(n?`${n}[${i}]`:i,e[i]));return r}function g(){let e={},n="",r=!1;const l=arguments;for(let i,s=0;s<l.length;s++)if(i=l[s],t.util.isBoolean(i))r=i;else if(t.util.isString(i)&&i)n=i;else if(Array.isArray(i)&&i.length){"class"in e||(e.class=[]),Array.isArray(e.class)||(e.class=[e.class]);for(let t=0;t<i.length;t++)e.class.push(i[t]);n="div"}else t.util.isPlainObject(i)&&(e=t.util.assign(e,i));const s=[];let o;for(let l in e)if(t.util.hasOwn(e,l))switch(o=e[l],l){case"tag":n||(n=o);break;case"close":r=t.util.toBoolean(o);break;default:!1!==o&&(l&&(l=t.util.hyphenate(l)),""===o||t.util.isBoolean(o)?s.push(l):(o=i(o),s.push(l?`${l}="${o}"`:o)))}let u=s.join(" ");return u=u?" "+u:"",n&&(n=n.replace(/<|>|\//gi,"")),n?`<${n+u}>`+(r?`</${n}>`:""):u}function b(e,i="",n={}){let r=!1;return t.util.isBoolean(n)?(r=n,n={}):t.util.isPlainObject(n)||(n={class:n}),t.util.isPlainObject(e)&&("href"in e?e=(n=e).href:"url"in n?(i=e[i||"title"],e=e.url):(n=e,e="#")),null===i?i=e:t.util.isPlainObject(i)?(n=i,i=""):t.util.isBoolean(i)&&(r=i,i=""),t.util.includes(e,"://")&&(r=!0),n.href=e,"target"in n||(n.target=!!r&&"_blank"),"rel"in n||(n.rel=!!r&&"noopener"),k(i,n,"a")}function k(e,i="",n=""){if(a("NBkit.wrap"),!i&&!n&&t.util.isString(e))return e;if((Array.isArray(i)||t.util.isPlainObject(i))&&(i=g(i,n)),t.util.isString(i)&&(t.util.startsWith(i,"uk-")||t.util.startsWith(i,"nb-"))&&(i=`<div class="${i}">`),i=u(i),Array.isArray(e)){let t=i.split(">")[0].replace("<","");e=e.join(`</${t.split(" ")[0]}><${t}>`)}let r;return t.util.includes(i,"></")&&!/=["|'][^"|']+(><\/)[^"|']+["|']/g.test(i)?(r=i.split("></"),i=`${r[0]}>${e}</${r.splice(1).join("></")}`):(r=i.split(">",2),i=2===r.length?`${i}${e}</${r[0].split(" ")[0].replace(/</gi,"")}>`:e),c("NBkit.wrap"),i}function $(i){if(t.util.isUndefined(i))return;Array.isArray(i)&&(i=i.join("<br>"));let n="primary",r={},l=!1,s={class:["uk-alert"]};const u=arguments;for(let e,i=1,o=0;i<u.length;i++)if(e=u[i],t.util.isBoolean(e))l=e;else if(t.util.isNumeric(e))e=t.util.toNumber(e),1==i?n=e<100||e>=400?"danger":"success":r.duration=e;else if(t.util.isString(e))n=e;else if(Array.isArray(e))for(;o<e.length;o++)s.class.push(e[o]);else if(t.util.isPlainObject(e))if("animation"in e)r=t.util.assign(r,e);else{if("class"in e){for(Array.isArray(e.class)||(e.class=e.class.split(" "));o<e.class.length;o++)s.class.push(e.class[o]);delete e.class}s=t.util.assign(s,e)}return"danger"==n&&(s.role="alert"),s.class.push("uk-alert-"+n),s.dataUkAlert=!l&&!Object.keys(r).length||t.util.assign({},e.ukAlert,r),k((l?g({type:"button",class:"uk-alert-close",title:"close",dataUkClose:!0},"button",!0):"")+k(i,o(i)?"":"p"),s,"div")}function y(){let e={},i={};const n=arguments;for(let r,l=1;l<n.length;l++)r=n[l],t.util.isNumeric(r)?i.ratio=t.util.toNumber(r):t.util.isString(r)?e.class=[r]:Array.isArray(r)?e.class=r:t.util.isPlainObject(r)&&(e=t.util.assign(e,r));return e.dataUkSpinner=!Object.keys(i).length||i,g(e,"span",!0)}function j(e,i=!0){let n,r="";i?(t.util.attr(e,"disabled",!0),n=y(.467),e.children.length?(t.util.addClass(e.children[0],"uk-hidden"),t.util.after(e.children[0],n)):(r=t.util.html(e),t.util.html(e,t.util.html(e).replace(r,n)),e.dataset.label=r)):(t.util.removeAttr(e,"disabled"),n=t.util.$(".uk-spinner",e),"label"in e.dataset&&(r=e.dataset.label,delete e.dataset.label),n&&(r?t.util.before(n,r):t.util.removeClass(e.children[0],"uk-hidden"),t.util.remove(n)))}function S(e,i,n){const r="NBkit.loadS"+("script"===e?"cript":"tyle");return a(r),new t.util.Promise(((l,s)=>{const o=document.createElement(e);let u;for(let e in i)t.util.hasOwn(i,e)&&(u=i[e],"element"===e?n=u:o.setAttribute(e,u));o.onload=()=>{c(r),l(o)},o.onerror=t=>{c(r),s(t)},t.util.append(n,o)}))}function O(e){return S("script",t.util.isPlainObject(e)?e:{src:e,async:!0},arguments.length>1?arguments[1]:"body")}function v(e){const i=t.util.isPlainObject(e)?e:{href:e};return i.rel="stylesheet",S("link",i,arguments.length>1?arguments[1]:"head")}var N=Object.freeze({__proto__:null,ajax:p,objectToFormData:m,post:function(t,e={}){return p(t,{data:m(e),method:"POST"})},buttonLoading:j,getPreviousSibling:function(t,e=""){let i=t.previousElementSibling;if(!e)return i;for(;i;){if(i.matches(e))return i;i=i.previousElementSibling}},loadAsset:S,loadAssets:function(e){let i=[];for(let n,r=0;r<e.length;r++)n=e[r],i.push("js"===(t.util.isPlainObject(n)?n.src?n.src:n.href?n.href:"":n).substr(-2)?O(n):v(n));return t.util.Promise.all(i)},loadScript:O,loadStyle:v,attrs:g,link:b,wrap:k,ukAlert:$,ukNotification:function(i){if(t.util.isUndefined(i))return;if(t.util.isString(i)&&(i={message:i}),!t.util.isPlainObject(i))return;const n=arguments;for(let e,r=1;r<n.length;r++)e=n[r],t.util.isNumeric(e)?i.timeout=t.util.toNumber(e):t.util.isString(e)?e.includes("-")?i.pos=e:i.status=e:t.util.isPlainObject(e)&&(i=t.util.assign(e,i));t.util.isUndefined(i.message)||t.notification(t.util.assign({},e.ukNotification,i))},ukSpinner:y,attrValue:i,base64Decode:n,base64Encode:r,data:l,debounce:function(t,i=e.duration,n=!1){let r;return function(){const e=this,l=arguments,s=()=>{r=null,n||t.apply(e,l)},o=n&&!r;clearTimeout(r),r=setTimeout(s,i),o&&t.apply(e,l)}},getClassName:function(e){if(t.util.isPlainObject(e))if("$options"in e)e=e.$options.name;else{const t=["name","title"];for(let i,n=0;n<t.length;n++)if(i=t[n],i in e){e=e[i];break}}return t.util.isString(e)?t.util.hyphenate(e).replace(/\s+/g,"-"):""},hasStorage:s,isTag:o,makeTag:u,profilerStart:a,profilerStop:c,punctuateString:f,queryString:d,setOption:h}),w={args:"msgConfirm",props:{callback:String,msgConfirm:String},data:{button:null,captcha:null,scroller:null},beforeConnect:function(){a("NBkit.Form.beforeConnect");const e=this.$el,i=t.util.$("input[type=hidden]._post_token",e);if(i){const e=e=>{t.util.attr(i,"name",e.tokenName),t.util.attr(i,"value",e.tokenValue)};let n=s?sessionStorage.getItem("CSRF"):"";if(n)try{e(JSON.parse(n))}catch(t){}else p({headers:{"PW-Session-CSRF":1},responseType:"json"}).then((t=>{n=t.response,e(n),s&&sessionStorage.setItem("CSRF",JSON.stringify(n))}),t.util.noop)}this.scroller=t.util.$(g({hidden:!0},"div",!0)),t.util.append(e,this.scroller),c("NBkit.Form.beforeConnect")},connected:function(){a("NBkit.Form.connected");const i=this,n=this.$el;setTimeout((function(){t.util.trigger(n,"onload",i),c("NBkit.Form.connected")}),e.duration)},events:{submit:function(i){a("NBkit.Form.events.submit"),i.preventDefault(),i.stopPropagation();const n=this.$el;let r=[];const l=t.util.$$(".nb-form-errors",n);if(l.length&&t.util.remove(l),t.util.$$("input[required], select[required], textarea[required]",n).forEach((e=>{t.util.attr(e,"aria-invalid",!1),t.util.remove(t.util.$(".nb-form-error",e.closest(".nb-form-content")))})),t.util.$$("input[required], select[required], textarea[required]",n).forEach((i=>{if(!i.validity.valid){t.util.attr(i,"aria-invalid",!0);let l=t.util.attr(i,"title");l||(l=i.validationMessage);const s=i.id,o=s?t.util.$(`label[for=${s}]`,n):null;l=f(l),r.push(b("#"+(s||n.id),(o?o.innerHTML+": ":"")+l,{class:"uk-link-reset",dataUkScroll:{duration:e.duration,offset:e.offset}}));const u=k(l,"uk-text-danger nb-form-error"),a=t.util.$("[role=alert]",i.closest(".nb-form-content"));a?t.util.append(a,u):t.util.before(i,u)}})),r.length)return t.util.trigger(n,"invalid",this),this.reset(),t.util.before(t.util.$(".uk-grid",n),$(k(k(r,"li"),"ul"),"danger",["nb-form-errors"])),UIkit.scroll(this.scroller,{duration:e.duration,offset:e.offset}).scrollTo(n),t.util.on('.nb-form-errors a[href^="#"]',"click",(function(){t.util.$(t.util.attr(this,"href")).focus()})),!1;if(this.button=t.util.$("button[type=submit]",n),this.msgConfirm){const t=this;UIkit.modal.confirm(this.msgConfirm).then((()=>t.send()),(()=>!1))}else this.send();c("NBkit.Form.events.submit")}},methods:{error:function(e){this.reset(),UIkit.modal.alert($(e,"danger")),t.util.trigger(this.$el,"error",this)},reset:function(){this.button&&j(this.button,!1),this.captcha&&grecaptcha.reset()},send:function(){a("NBkit.Form.send");const i=this.$el,n=t.util.attr(i,"method");j(this.button),this.captcha=t.util.$(".g-recaptcha",i),t.util.trigger(i,"beforeSend",this);const r=this;p(i.action,{data:new FormData(i),method:n||"POST"}).then((n=>{const{response:l}=n,s=parseInt(n.getResponseHeader("NB-Form-State"));if(r.callback&&r.callback in window)window[r.callback].call(r,n);else if(200===s){t.util.remove(this.button),this.captcha&&t.util.remove(this.captcha),t.util.$$("input, select, textarea",i).forEach((e=>{t.util.attr(e,"disabled",!0)}));const n=t.util.$(".uk-grid",i);t.util.before(n||i,$(l,s)),UIkit.scroll(r.scroller,{duration:e.duration,offset:e.offset}).scrollTo(i),t.util.trigger(i,"complete",r)}else r.error(l);c("NBkit.Form.send")}),(t=>{r.error(t),c("NBkit.Form.send")}))}}},A={props:{container:String,filter:String,message:String,more:String,url:String},data:{container:".nb-items-container",filter:".nb-items-filter",message:".nb-items-message",more:".nb-items-more",url:window.location.href},events:[{name:"click",delegate:function(){return this.more+" button"},handler:function(t){this.request(!0)}},{name:"click",delegate:function(){return this.filter+" [data-filter]:not(.uk-active)"},handler:function(e){const i=e.target;t.util.removeClass(t.util.$$(".uk-active",i.closest(this.filter)),"uk-active"),t.util.addClass(i,"uk-active"),this.setUrl(l(i,"filter")),this.request()}},{name:"change",delegate:function(){return this.filter+" form select"},handler:function(e){const i=e.target.closest("form");t.util.$("button",i)||t.util.trigger(i,"submit")}},{name:"submit reset",delegate:function(){return this.filter+" form"},handler:function(e){const i=e.target,n={};if("submit"===e.type){e.preventDefault(),e.stopPropagation();const s=Array.from(new FormData(i).entries()),o={};if(t.util.isArray(s))for(let r,u,a,c,f,d,h,p=0;p<s.length;p++)if(u=s[p][1],u){if(a=s[p][0],c=t.util.$$(`[name="${a}"]`,i),f=c.length,f)if(1===f)d=c[0];else for(r=0;r<f;r++)if((e=c[r]).value===u){d=e;break}if(d)if(t.util.hasAttr(d,"data-selectors"))for(h=l(d,"selectors"),r=0;r<h.keys.length;r++)o[h.keys[r]]=h.values[d.value][r];else t.util.hasAttr(d,"data-selector")?o[a+t.util.data(d,"selector")]=u:n[a]=u}t.util.isEmpty(o)||(n.selectors=r(o))}else t.util.$$(".uk-input",i).forEach((e=>{t.util.attr(e,"value","")})),t.util.$$(".uk-select",i).forEach((e=>{let i=t.util.$$("option",e);t.util.removeAttr(i,"selected"),t.util.attr(i[0],"selected",!0)}));this.setUrl(n),this.request()}}],methods:{request:function(e=!1){a("NBkit.Items.request");const i=this.$el,n=t.util.$(this.container,i);if(!n)return void c("NBkit.Items.request");const r=t.util.$(this.more,i),l=r?t.util.$("button",r):null;e||(n&&t.util.html(n,""),r&&t.util.removeClass(r,"uk-hidden")),t.util.remove(".uk-alert",i),l&&j(l);const s=this;p(this.url,{headers:{"NB-Items-LoadMore":e}}).then((e=>{const o=parseInt(e.getResponseHeader("NB-Items-Cursor")),u=parseInt(e.getResponseHeader("NB-Items-Total"));l&&j(l,!1),t.util.append(n,e.response);const a=t.util.$(s.message,i);if(a){let e;const i={cursor:o,total:u};Object.keys(i).forEach((n=>{e=t.util.$(`[data-${n}]`,a),e&&(e.innerText=i[n])}))}(r&&u-o<=0||204===e.status)&&t.util.addClass(r,"uk-hidden"),t.util.trigger(i,"complete",s),c("NBkit.Items.request")}),(e=>{t.util.trigger(i,"error",s),t.util.html(n,""),t.util.before(n,$(e,500)),r&&t.util.addClass(r,"uk-hidden"),c("NBkit.Items.request")}))},setUrl:function(t={}){this.url=this.url.split("?")[0]+d(t)}}},B={args:"text",props:["text"],beforeConnect:function(){a("NBkit.Obfuscate.beforeConnect");const e=n(this.text);let r=e;if(t.util.isPlainObject(e)){r=e.text;for(let n in e)t.util.hasOwn(e,n)&&"text"!==n&&("href"!==n||r||(r=e[n]),t.util.attr(this.$el,n,i(e[n])))}this.$el.innerHTML=r,t.util.removeAttr(this.$el,"data-"+this.$name),c("NBkit.Obfuscate.beforeConnect")}},P=Object.freeze({__proto__:null,nbForm:w,nbItems:A,nbObfuscate:B});const C=t.util.noop;return C.options=e,C.util=N,C.version="1.3.0",t.util.each(P,((t,e)=>{window.UIkit.component(e,t)})),window.nb=N,window.uk=t.util,a("NBkit.init"),t.util.ready((()=>{const e=t.util.$("header");e&&h("offset",e.offsetHeight);const i=t.util.$$("a[target=_blank]");if(i){let e;i.forEach((i=>{e=t.util.attr(i,"rel"),e=t.util.isString(e)?e.split(" "):[],t.util.includes(e,"noopener")||e.push("noopener"),t.util.attr(i,"rel",e.join(" "))}))}c("NBkit.init")})),C}));
