{{ $indexTemplate := resources.Get "js/main.js" -}}
{{ $index := $indexTemplate | resources.ExecuteAsTemplate "js/main.js" . -}}

{{ $ui := resources.Get "js/uikit.js" -}}
{{ $ui := $ui | js.Build -}}

{{ $nbkit := resources.Get "js/nbkit.min.js" -}}
{{ $nbkit := $nbkit | js.Build -}}

{{ $mmenu := resources.Get "js/mmenu.js" -}}
{{ $mmenu := $mmenu | js.Build -}}

{{ $app := resources.Get "js/main.js" -}}

{{ $slice := slice $app -}}

{{ $js := $slice | resources.Concat "js/main.js" -}}

{{ if eq (hugo.Environment) "development" -}}
  {{ if .Site.Params.options.uikitJs -}}
    <script src="{{ $ui.RelPermalink }}" defer></script>
  {{ end -}}
  {{ if .Site.Params.options.nbkitJs -}}
    <script src="{{ $nbkit.RelPermalink }}" defer></script>
  {{ end -}}
  {{ if .Site.Params.options.mmenuJs -}}
    <script src="{{ $mmenu.RelPermalink }}" defer></script>
  {{ end -}}
  <script src="{{ $js.RelPermalink }}" defer></script>
{{ else -}}
  {{ $js := $js | minify | fingerprint "sha512" -}}
  {{ $index := $index | minify | fingerprint "sha512" -}}
  {{ $nbkit := $ui | minify | fingerprint "sha512" -}}
  {{ $mmenu := $mmenu | minify | fingerprint "sha512" -}}
  {{ if .Site.Params.options.uikitJs -}}
    <script src="{{ $ui.RelPermalink }}" integrity="{{ $ui.Data.Integrity }}" crossorigin="anonymous" defer></script>
  {{ end -}}
  {{ if .Site.Params.options.nbkitJs -}}
    <script src="{{ $nbkit.RelPermalink }}" integrity="{{ $nbkit.Data.Integrity }}" crossorigin="anonymous" defer></script>
  {{ end -}}
  {{ if .Site.Params.options.mmenuJs -}}
    <script src="{{ $mmenu.RelPermalink }}" integrity="{{ $mmenu.Data.Integrity }}" crossorigin="anonymous" defer></script>
  {{ end -}}
  <script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" crossorigin="anonymous" defer></script>
{{ end -}}